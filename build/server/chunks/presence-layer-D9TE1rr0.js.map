{"version":3,"file":"presence-layer-D9TE1rr0.js","sources":["../../../.svelte-kit/adapter-node/chunks/presence-layer.js"],"sourcesContent":["import \"clsx\";\nimport { I as derived, w as push, y as pop } from \"./index.js\";\nimport { w as watch, b as box, p as executeCallbacks } from \"./attrs.js\";\nimport \"style-to-object\";\nimport { o as on } from \"./events.js\";\nclass Previous {\n  #previous = void 0;\n  constructor(getter, initialValue) {\n    if (initialValue !== void 0) this.#previous = initialValue;\n    watch(() => getter(), (_, v) => {\n      this.#previous = v;\n    });\n  }\n  get current() {\n    return this.#previous;\n  }\n}\nconst ARROW_DOWN = \"ArrowDown\";\nconst ARROW_LEFT = \"ArrowLeft\";\nconst ARROW_RIGHT = \"ArrowRight\";\nconst ARROW_UP = \"ArrowUp\";\nconst END = \"End\";\nconst ENTER = \"Enter\";\nconst ESCAPE = \"Escape\";\nconst HOME = \"Home\";\nconst PAGE_DOWN = \"PageDown\";\nconst PAGE_UP = \"PageUp\";\nconst SPACE = \" \";\nconst TAB = \"Tab\";\nclass StateMachine {\n  state;\n  #machine;\n  constructor(initialState, machine) {\n    this.state = box(initialState);\n    this.#machine = machine;\n    this.dispatch = this.dispatch.bind(this);\n  }\n  #reducer(event) {\n    const nextState = this.#machine[this.state.current][event];\n    return nextState ?? this.state.current;\n  }\n  dispatch(event) {\n    this.state.current = this.#reducer(event);\n  }\n}\nconst presenceMachine = {\n  mounted: {\n    UNMOUNT: \"unmounted\",\n    ANIMATION_OUT: \"unmountSuspended\"\n  },\n  unmountSuspended: { MOUNT: \"mounted\", ANIMATION_END: \"unmounted\" },\n  unmounted: { MOUNT: \"mounted\" }\n};\nclass Presence {\n  opts;\n  prevAnimationNameState = \"none\";\n  styles = {};\n  initialStatus;\n  previousPresent;\n  machine;\n  present;\n  constructor(opts) {\n    this.opts = opts;\n    this.present = this.opts.open;\n    this.initialStatus = opts.open.current ? \"mounted\" : \"unmounted\";\n    this.previousPresent = new Previous(() => this.present.current);\n    this.machine = new StateMachine(this.initialStatus, presenceMachine);\n    this.handleAnimationEnd = this.handleAnimationEnd.bind(this);\n    this.handleAnimationStart = this.handleAnimationStart.bind(this);\n    watchPresenceChange(this);\n    watchStatusChange(this);\n    watchRefChange(this);\n  }\n  /**\n   * Triggering an ANIMATION_OUT during an ANIMATION_IN will fire an `animationcancel`\n   * event for ANIMATION_IN after we have entered `unmountSuspended` state. So, we\n   * make sure we only trigger ANIMATION_END for the currently active animation.\n   */\n  handleAnimationEnd(event) {\n    if (!this.opts.ref.current) return;\n    const currAnimationName = getAnimationName(this.opts.ref.current);\n    const isCurrentAnimation = currAnimationName.includes(event.animationName) || currAnimationName === \"none\";\n    if (event.target === this.opts.ref.current && isCurrentAnimation) {\n      this.machine.dispatch(\"ANIMATION_END\");\n    }\n  }\n  handleAnimationStart(event) {\n    if (!this.opts.ref.current) return;\n    if (event.target === this.opts.ref.current) {\n      this.prevAnimationNameState = getAnimationName(this.opts.ref.current);\n    }\n  }\n  #isPresent = derived(() => {\n    return [\"mounted\", \"unmountSuspended\"].includes(this.machine.state.current);\n  });\n  get isPresent() {\n    return this.#isPresent();\n  }\n  set isPresent($$value) {\n    return this.#isPresent($$value);\n  }\n}\nfunction watchPresenceChange(state) {\n  watch(() => state.present.current, () => {\n    if (!state.opts.ref.current) return;\n    const hasPresentChanged = state.present.current !== state.previousPresent.current;\n    if (!hasPresentChanged) return;\n    const prevAnimationName = state.prevAnimationNameState;\n    const currAnimationName = getAnimationName(state.opts.ref.current);\n    if (state.present.current) {\n      state.machine.dispatch(\"MOUNT\");\n    } else if (currAnimationName === \"none\" || state.styles.display === \"none\") {\n      state.machine.dispatch(\"UNMOUNT\");\n    } else {\n      const isAnimating = prevAnimationName !== currAnimationName;\n      if (state.previousPresent.current && isAnimating) {\n        state.machine.dispatch(\"ANIMATION_OUT\");\n      } else {\n        state.machine.dispatch(\"UNMOUNT\");\n      }\n    }\n  });\n}\nfunction watchStatusChange(state) {\n  watch(() => state.machine.state.current, () => {\n    if (!state.opts.ref.current) return;\n    const currAnimationName = getAnimationName(state.opts.ref.current);\n    state.prevAnimationNameState = state.machine.state.current === \"mounted\" ? currAnimationName : \"none\";\n  });\n}\nfunction watchRefChange(state) {\n  watch(() => state.opts.ref.current, () => {\n    if (!state.opts.ref.current) return;\n    state.styles = getComputedStyle(state.opts.ref.current);\n    return executeCallbacks(on(state.opts.ref.current, \"animationstart\", state.handleAnimationStart), on(state.opts.ref.current, \"animationcancel\", state.handleAnimationEnd), on(state.opts.ref.current, \"animationend\", state.handleAnimationEnd));\n  });\n}\nfunction getAnimationName(node) {\n  return node ? getComputedStyle(node).animationName || \"none\" : \"none\";\n}\nfunction Presence_layer($$payload, $$props) {\n  push();\n  let { open, forceMount, presence, ref } = $$props;\n  const presenceState = new Presence({ open: box.with(() => open), ref });\n  if (forceMount || open || presenceState.isPresent) {\n    $$payload.out += \"<!--[-->\";\n    presence?.($$payload, { present: presenceState.isPresent });\n    $$payload.out += `<!---->`;\n  } else {\n    $$payload.out += \"<!--[!-->\";\n  }\n  $$payload.out += `<!--]-->`;\n  pop();\n}\nexport {\n  ARROW_UP as A,\n  END as E,\n  HOME as H,\n  Presence_layer as P,\n  SPACE as S,\n  TAB as T,\n  ARROW_RIGHT as a,\n  ARROW_LEFT as b,\n  ARROW_DOWN as c,\n  ENTER as d,\n  PAGE_UP as e,\n  PAGE_DOWN as f,\n  Previous as g,\n  ESCAPE as h\n};\n"],"names":[],"mappings":";;;;AAKA,MAAM,QAAQ,CAAC;AACf,EAAE,SAAS,GAAG,MAAM;AACpB,EAAE,WAAW,CAAC,MAAM,EAAE,YAAY,EAAE;AACpC,IAAI,IAAI,YAAY,KAAK,MAAM,EAAE,IAAI,CAAC,SAAS,GAAG,YAAY;AAC9D,IAAI,KAAK,CAAC,MAAM,MAAM,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK;AACpC,MAAM,IAAI,CAAC,SAAS,GAAG,CAAC;AACxB,KAAK,CAAC;AACN;AACA,EAAE,IAAI,OAAO,GAAG;AAChB,IAAI,OAAO,IAAI,CAAC,SAAS;AACzB;AACA;AACK,MAAC,UAAU,GAAG;AACd,MAAC,UAAU,GAAG;AACd,MAAC,WAAW,GAAG;AACf,MAAC,QAAQ,GAAG;AACZ,MAAC,GAAG,GAAG;AACP,MAAC,KAAK,GAAG;AACT,MAAC,MAAM,GAAG;AACV,MAAC,IAAI,GAAG;AACR,MAAC,SAAS,GAAG;AACb,MAAC,OAAO,GAAG;AACX,MAAC,KAAK,GAAG;AACT,MAAC,GAAG,GAAG;AACZ,MAAM,YAAY,CAAC;AACnB,EAAE,KAAK;AACP,EAAE,QAAQ;AACV,EAAE,WAAW,CAAC,YAAY,EAAE,OAAO,EAAE;AACrC,IAAI,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC;AAClC,IAAI,IAAI,CAAC,QAAQ,GAAG,OAAO;AAC3B,IAAI,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC;AAC5C;AACA,EAAE,QAAQ,CAAC,KAAK,EAAE;AAClB,IAAI,MAAM,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC;AAC9D,IAAI,OAAO,SAAS,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO;AAC1C;AACA,EAAE,QAAQ,CAAC,KAAK,EAAE;AAClB,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;AAC7C;AACA;AACA,MAAM,eAAe,GAAG;AACxB,EAAE,OAAO,EAAE;AACX,IAAI,OAAO,EAAE,WAAW;AACxB,IAAI,aAAa,EAAE;AACnB,GAAG;AACH,EAAE,gBAAgB,EAAE,EAAE,KAAK,EAAE,SAAS,EAAE,aAAa,EAAE,WAAW,EAAE;AACpE,EAAE,SAAS,EAAE,EAAE,KAAK,EAAE,SAAS;AAC/B,CAAC;AACD,MAAM,QAAQ,CAAC;AACf,EAAE,IAAI;AACN,EAAE,sBAAsB,GAAG,MAAM;AACjC,EAAE,MAAM,GAAG,EAAE;AACb,EAAE,aAAa;AACf,EAAE,eAAe;AACjB,EAAE,OAAO;AACT,EAAE,OAAO;AACT,EAAE,WAAW,CAAC,IAAI,EAAE;AACpB,IAAI,IAAI,CAAC,IAAI,GAAG,IAAI;AACpB,IAAI,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI;AACjC,IAAI,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,SAAS,GAAG,WAAW;AACpE,IAAI,IAAI,CAAC,eAAe,GAAG,IAAI,QAAQ,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC;AACnE,IAAI,IAAI,CAAC,OAAO,GAAG,IAAI,YAAY,CAAC,IAAI,CAAC,aAAa,EAAE,eAAe,CAAC;AACxE,IAAI,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC;AAChE,IAAI,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC;AACpE,IAAI,mBAAmB,CAAC,IAAI,CAAC;AAC7B,IAAI,iBAAiB,CAAC,IAAI,CAAC;AAC3B,IAAI,cAAc,CAAC,IAAI,CAAC;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,kBAAkB,CAAC,KAAK,EAAE;AAC5B,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;AAChC,IAAI,MAAM,iBAAiB,GAAG,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC;AACrE,IAAI,MAAM,kBAAkB,GAAG,iBAAiB,CAAC,QAAQ,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,iBAAiB,KAAK,MAAM;AAC9G,IAAI,IAAI,KAAK,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,IAAI,kBAAkB,EAAE;AACtE,MAAM,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,eAAe,CAAC;AAC5C;AACA;AACA,EAAE,oBAAoB,CAAC,KAAK,EAAE;AAC9B,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;AAChC,IAAI,IAAI,KAAK,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;AAChD,MAAM,IAAI,CAAC,sBAAsB,GAAG,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC;AAC3E;AACA;AACA,EAAE,UAAU,GAAG,OAAO,CAAC,MAAM;AAC7B,IAAI,OAAO,CAAC,SAAS,EAAE,kBAAkB,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC;AAC/E,GAAG,CAAC;AACJ,EAAE,IAAI,SAAS,GAAG;AAClB,IAAI,OAAO,IAAI,CAAC,UAAU,EAAE;AAC5B;AACA,EAAE,IAAI,SAAS,CAAC,OAAO,EAAE;AACzB,IAAI,OAAO,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;AACnC;AACA;AACA,SAAS,mBAAmB,CAAC,KAAK,EAAE;AACpC,EAAE,KAAK,CAAC,MAAM,KAAK,CAAC,OAAO,CAAC,OAAO,EAAE,MAAM;AAC3C,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;AACjC,IAAI,MAAM,iBAAiB,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,KAAK,KAAK,CAAC,eAAe,CAAC,OAAO;AACrF,IAAI,IAAI,CAAC,iBAAiB,EAAE;AAC5B,IAAI,MAAM,iBAAiB,GAAG,KAAK,CAAC,sBAAsB;AAC1D,IAAI,MAAM,iBAAiB,GAAG,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC;AACtE,IAAI,IAAI,KAAK,CAAC,OAAO,CAAC,OAAO,EAAE;AAC/B,MAAM,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC;AACrC,KAAK,MAAM,IAAI,iBAAiB,KAAK,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,KAAK,MAAM,EAAE;AAChF,MAAM,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,CAAC;AACvC,KAAK,MAAM;AACX,MAAM,MAAM,WAAW,GAAG,iBAAiB,KAAK,iBAAiB;AACjE,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,OAAO,IAAI,WAAW,EAAE;AACxD,QAAQ,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,eAAe,CAAC;AAC/C,OAAO,MAAM;AACb,QAAQ,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,CAAC;AACzC;AACA;AACA,GAAG,CAAC;AACJ;AACA,SAAS,iBAAiB,CAAC,KAAK,EAAE;AAClC,EAAE,KAAK,CAAC,MAAM,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,MAAM;AACjD,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;AACjC,IAAI,MAAM,iBAAiB,GAAG,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC;AACtE,IAAI,KAAK,CAAC,sBAAsB,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,KAAK,SAAS,GAAG,iBAAiB,GAAG,MAAM;AACzG,GAAG,CAAC;AACJ;AACA,SAAS,cAAc,CAAC,KAAK,EAAE;AAC/B,EAAE,KAAK,CAAC,MAAM,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,MAAM;AAC5C,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;AACjC,IAAI,KAAK,CAAC,MAAM,GAAG,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC;AAC3D,IAAI,OAAO,gBAAgB,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,gBAAgB,EAAE,KAAK,CAAC,oBAAoB,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,iBAAiB,EAAE,KAAK,CAAC,kBAAkB,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,cAAc,EAAE,KAAK,CAAC,kBAAkB,CAAC,CAAC;AACpP,GAAG,CAAC;AACJ;AACA,SAAS,gBAAgB,CAAC,IAAI,EAAE;AAChC,EAAE,OAAO,IAAI,GAAG,gBAAgB,CAAC,IAAI,CAAC,CAAC,aAAa,IAAI,MAAM,GAAG,MAAM;AACvE;AACA,SAAS,cAAc,CAAC,SAAS,EAAE,OAAO,EAAE;AAC5C,EAAE,IAAI,EAAE;AACR,EAAE,IAAI,EAAE,IAAI,EAAE,UAAU,EAAE,QAAQ,EAAE,GAAG,EAAE,GAAG,OAAO;AACnD,EAAE,MAAM,aAAa,GAAG,IAAI,QAAQ,CAAC,EAAE,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;AACzE,EAAE,IAAI,UAAU,IAAI,IAAI,IAAI,aAAa,CAAC,SAAS,EAAE;AACrD,IAAI,SAAS,CAAC,GAAG,IAAI,UAAU;AAC/B,IAAI,QAAQ,GAAG,SAAS,EAAE,EAAE,OAAO,EAAE,aAAa,CAAC,SAAS,EAAE,CAAC;AAC/D,IAAI,SAAS,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC;AAC9B,GAAG,MAAM;AACT,IAAI,SAAS,CAAC,GAAG,IAAI,WAAW;AAChC;AACA,EAAE,SAAS,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC;AAC7B,EAAE,GAAG,EAAE;AACP;;;;"}