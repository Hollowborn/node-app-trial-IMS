{"version":3,"file":"_server.ts-BnDS0MuQ.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/uploads/_...path_/_server.ts.js"],"sourcesContent":["import { e as error } from \"../../../../../chunks/index2.js\";\nimport { existsSync, readFileSync } from \"fs\";\nimport path from \"path\";\nconst UPLOADS_BASE_DIR = path.join(process.cwd(), \"uploads\");\nasync function GET({ params }) {\n  const requestedPath = params.path;\n  const filePath = path.join(UPLOADS_BASE_DIR, requestedPath);\n  const absolutePath = path.resolve(filePath);\n  if (!absolutePath.startsWith(UPLOADS_BASE_DIR)) {\n    throw error(403, \"Forbidden: Attempted directory traversal\");\n  }\n  if (!existsSync(absolutePath)) {\n    throw error(404, \"Not Found\");\n  }\n  try {\n    const fileContent = readFileSync(absolutePath);\n    const mimeType = getMimeType(absolutePath);\n    return new Response(fileContent, {\n      headers: {\n        \"Content-Type\": mimeType,\n        \"Cache-Control\": \"public, max-age=31536000\"\n        // Cache images for a year\n      }\n    });\n  } catch (e) {\n    console.error(`Error serving file ${absolutePath}:`, e);\n    throw error(500, \"Internal Server Error: Failed to serve image\");\n  }\n}\nfunction getMimeType(filePath) {\n  const ext = path.extname(filePath).toLowerCase();\n  switch (ext) {\n    case \".jpg\":\n    case \".jpeg\":\n      return \"image/jpeg\";\n    case \".png\":\n      return \"image/png\";\n    case \".gif\":\n      return \"image/gif\";\n    case \".webp\":\n      return \"image/webp\";\n    case \".svg\":\n      return \"image/svg+xml\";\n    // Add SVG if you support it\n    // Add more types as needed\n    default:\n      return \"application/octet-stream\";\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;AAGA,MAAM,gBAAgB,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,SAAS,CAAC;AAC5D,eAAe,GAAG,CAAC,EAAE,MAAM,EAAE,EAAE;AAC/B,EAAE,MAAM,aAAa,GAAG,MAAM,CAAC,IAAI;AACnC,EAAE,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,aAAa,CAAC;AAC7D,EAAE,MAAM,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;AAC7C,EAAE,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,gBAAgB,CAAC,EAAE;AAClD,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,0CAA0C,CAAC;AAChE;AACA,EAAE,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,EAAE;AACjC,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,WAAW,CAAC;AACjC;AACA,EAAE,IAAI;AACN,IAAI,MAAM,WAAW,GAAG,YAAY,CAAC,YAAY,CAAC;AAClD,IAAI,MAAM,QAAQ,GAAG,WAAW,CAAC,YAAY,CAAC;AAC9C,IAAI,OAAO,IAAI,QAAQ,CAAC,WAAW,EAAE;AACrC,MAAM,OAAO,EAAE;AACf,QAAQ,cAAc,EAAE,QAAQ;AAChC,QAAQ,eAAe,EAAE;AACzB;AACA;AACA,KAAK,CAAC;AACN,GAAG,CAAC,OAAO,CAAC,EAAE;AACd,IAAI,OAAO,CAAC,KAAK,CAAC,CAAC,mBAAmB,EAAE,YAAY,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;AAC3D,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,8CAA8C,CAAC;AACpE;AACA;AACA,SAAS,WAAW,CAAC,QAAQ,EAAE;AAC/B,EAAE,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,WAAW,EAAE;AAClD,EAAE,QAAQ,GAAG;AACb,IAAI,KAAK,MAAM;AACf,IAAI,KAAK,OAAO;AAChB,MAAM,OAAO,YAAY;AACzB,IAAI,KAAK,MAAM;AACf,MAAM,OAAO,WAAW;AACxB,IAAI,KAAK,MAAM;AACf,MAAM,OAAO,WAAW;AACxB,IAAI,KAAK,OAAO;AAChB,MAAM,OAAO,YAAY;AACzB,IAAI,KAAK,MAAM;AACf,MAAM,OAAO,eAAe;AAC5B;AACA;AACA,IAAI;AACJ,MAAM,OAAO,0BAA0B;AACvC;AACA;;;;"}